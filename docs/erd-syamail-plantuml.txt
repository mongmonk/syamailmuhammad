@startuml ERD Syamail Muhammadiyah

' Entitas/Tabel Database
entity users {
  *id (PK)
  --
  *name
  *email (encrypted)
  phone (encrypted)
  *password (hashed)
  email_verified_at
  remember_token
  created_at
  updated_at
}

entity chapters {
  *id (PK)
  --
  *title
  description
  *chapter_number
  created_at
  updated_at
}

entity hadiths {
  *id (PK)
  --
  *chapter_id (FK)
  *arabic_text
  *translation
  interpretation
  *narration_source
  *hadith_number
  created_at
  updated_at
}

entity audio_files {
  *id (PK)
  --
  *hadith_id (FK, unique)
  *file_path
  duration
  file_size
  created_at
  updated_at
}

entity bookmarks {
  *id (PK)
  --
  *user_id (FK)
  *hadith_id (FK)
  notes
  created_at
  updated_at
}

entity user_notes {
  *id (PK)
  --
  *user_id (FK)
  *hadith_id (FK)
  *note_content
  created_at
  updated_at
}

entity search_history {
  *id (PK)
  --
  user_id (FK, nullable)
  *query
  results_count
  *created_at
}

' Relasi Antar Tabel
users ||--o{ bookmarks : "has"
users ||--o{ user_notes : "has"
users ||--o{ search_history : "has"

chapters ||--o{ hadiths : "contains"

hadiths |o--|| audio_files : "has"

hadiths }o--|| bookmarks : "bookmarked by"
hadiths }o--|| user_notes : "noted by"

' Keterangan Tambahan
note as users_note
  Enkripsi data sensitif:
  - email (encrypted)
  - phone (encrypted)
end note

users .. users_note

note as audio_note
  Fitur lazy loading
  untuk performa optimal
end note

audio_files .. audio_note

note as chapters_note
  Indeks:
  - idx_chapters_number
end note

chapters .. chapters_note

note as hadiths_note
  Indeks:
  - idx_hadiths_number
  - idx_hadiths_chapter
  - idx_hadiths_arabic_text (full-text)
  - idx_hadiths_translation (full-text)
  - idx_hadiths_interpretation (full-text)
end note

hadiths .. hadiths_note

note as bookmarks_note
  Indeks:
  - idx_bookmarks_user
  - idx_bookmarks_hadith
end note

bookmarks .. bookmarks_note

note as user_notes_note
  Indeks:
  - idx_user_notes_user
  - idx_user_notes_hadith
end note

user_notes .. user_notes_note

note as search_note
  Indeks:
  - idx_search_history_user
  - idx_search_history_query
end note

search_history .. search_note

@enduml